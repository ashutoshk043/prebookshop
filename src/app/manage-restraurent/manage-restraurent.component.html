<app-sidebar #sidebar></app-sidebar>

<div class="main-content" [class.sidebar-collapsed]="sidebar.isCollapsed">
  <app-header></app-header>
  <div class="center-register-form-container">
    <app-create-restraurent-form (formStatus)="onFormStatusChange($event)" (formSubmit)="onFormSubmit($event)"
      (ownerEmailListChange)="onOwnerEmailListChange($event)"></app-create-restraurent-form>
  </div>
  <main class="container-fluid py-4">

    <!-- Page Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
      <h2 class="h4 fw-semibold mb-3 mb-md-0">Restaurant Management</h2>

      <button (click)="openForm('add')" class="btn btn-primary d-flex align-items-center gap-2">
        <i class="bi bi-plus-lg"></i>
        Add New Restaurant
      </button>
    </div>

    <!-- Stats -->
    <div class="row g-3 mb-4">
      <div class="col-sm-6 col-lg-3">
        <div class="card shadow-sm border-0">
          <div class="card-body d-flex align-items-center gap-3">
            <div class="bg-primary bg-opacity-10 text-primary rounded p-3">
              <i class="bi bi-shop fs-4"></i>
            </div>
            <div>
              <p class="text-muted mb-1 small">Total Restaurants</p>
              <h4 class="mb-1">{{ summary.totalRestaurants }}</h4>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-lg-3">
        <div class="card shadow-sm border-0">
          <div class="card-body d-flex align-items-center gap-3">
            <div class="bg-success bg-opacity-10 text-success rounded p-3">
              <i class="bi bi-check-circle fs-4"></i>
            </div>
            <div>
              <p class="text-muted mb-1 small">Active Restaurants</p>
              <h4 class="mb-1">
                {{ summary.openCount }}
              </h4>
            </div>
          </div>
        </div>
      </div>

      <div class="col-sm-6 col-lg-3">
        <div class="card shadow-sm border-0">
          <div class="card-body d-flex align-items-center gap-3">
            <div class="bg-warning bg-opacity-10 text-warning rounded p-3">
              <i class="bi bi-hourglass-split fs-4"></i>
            </div>
            <div>
              <p class="text-muted mb-1 small">Inactive Restaurants</p>
              <h4 class="mb-1">
                {{ summary.closedCount }}
              </h4>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-body">
        <div class="row g-3 align-items-center">

          <!-- Search -->
          <div class="col-md-4">
            <div class="input-group">
              <span class="input-group-text bg-white border-end-0">
                <i class="bi bi-search text-muted"></i>
              </span>
              <input type="text" class="form-control border-start-0" placeholder="Search restaurants..."
                (keyup)="onSearch($event)" />
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="text-center py-5">
      <div class="spinner-border text-primary"></div>
    </div>

    <!-- Restaurants Table -->
    <div *ngIf="!loading" class="card shadow-sm border-0">
      <div class="table-responsive">

        <table class="table table-hover align-middle mb-0">
          <thead class="table-light text-uppercase small text-muted">
            <tr>
              <th>#</th>
              <th>Restaurant Name</th>
              <th>Owner Email</th>
              <th>Status</th>
              <th class="text-end">Actions</th>
            </tr>
          </thead>

          <tbody>

            <tr *ngFor="let restaurant of restaurants; let i = index">
              <td>{{ (page - 1) * limit + i + 1 }}</td>

              <td>
                <div class="d-flex align-items-center gap-2">
                  <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
                    style="width:40px; height:40px;">
                    {{ restaurant.restaurantName.charAt(0) | uppercase }}
                  </div>

                  <div>
                    <div class="fw-medium">{{ restaurant.restaurantName }}</div>
                    <small class="text-muted">#{{ restaurant.id }}</small>
                  </div>
                </div>
              </td>

              <td>{{ getOwnerEmail(restaurant.ownerEmail) }}</td>

              <td>
                <span class="badge" [ngClass]="restaurant.isVerified ? 'bg-success' : 'bg-warning text-dark'">
                  {{ restaurant.isVerified ? 'Open' : 'Pending' }}
                </span>
              </td>

              <td class="text-end">
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-secondary" (click)="editRestaurant(restaurant)">
                    <i class="bi bi-pencil"></i>
                  </button>
                  <!-- <button class="btn btn-outline-secondary" (click)="viewRestaurant(restaurant)">
                  <i class="bi bi-eye"></i>
                </button> -->
                  <button class="btn btn-outline-danger" (click)="openDeleteModal(restaurant)">
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>

            <tr *ngIf="restaurants.length === 0">
              <td colspan="5" class="text-center text-muted py-4">
                No restaurants found
              </td>
            </tr>

          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <div class="card-footer d-flex flex-column flex-md-row justify-content-between align-items-center">

        <div class="text-muted small mb-2 mb-md-0">
          Showing
          {{ (page - 1) * limit + 1 }}
          to
          {{ page * limit > totalRecords ? totalRecords : page * limit }}
          of {{ totalRecords }} restaurants
        </div>

        <!-- Pagination -->
        <nav *ngIf="totalPages > 1">
          <ul class="pagination pagination-sm mb-0">

            <!-- Prev -->
            <li class="page-item" [class.disabled]="page === 1">
              <button class="page-link" (click)="prevPage()">Previous</button>
            </li>

            <!-- Page Numbers -->
            <li class="page-item" *ngFor="let p of pages" [class.active]="p === page">
              <button class="page-link" (click)="goToPage(p)">
                {{ p }}
              </button>
            </li>

            <!-- Next -->
            <li class="page-item" [class.disabled]="page === totalPages">
              <button class="page-link" (click)="nextPage()">Next</button>
            </li>

          </ul>
        </nav>

      </div>


    </div>

  </main>


</div>


<!-- ðŸ”´ Delete Confirmation Modal -->
<div class="modal fade show" *ngIf="showDeleteModal" style="display:block; background:rgba(0,0,0,0.5);">

  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content border-0 shadow-lg rounded-4">

      <!-- Header -->
      <div class="modal-header bg-danger text-white">
        <h5 class="modal-title">
          <i class="bi bi-exclamation-triangle me-2"></i>
          Confirm Delete
        </h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeDeleteModal()"></button>
      </div>

      <!-- Body -->
      <div class="modal-body text-center p-4">
        <i class="bi bi-trash fs-1 text-danger mb-3"></i>

        <p class="fs-6">
          Are you sure you want to delete
          <strong>{{ restaurantToDelete?.restaurantName }}</strong>?
        </p>

        <p class="text-muted small">
          This action cannot be undone.
        </p>
      </div>

      <!-- Footer -->
      <div class="modal-footer justify-content-center">
        <button class="btn btn-outline-secondary px-4" (click)="closeDeleteModal()">
          Cancel
        </button>

        <button class="btn btn-danger px-4" (click)="confirmDelete()">
          Yes, Delete
        </button>
      </div>

    </div>
  </div>
</div>