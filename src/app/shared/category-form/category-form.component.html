<form [formGroup]="categoryForm" (ngSubmit)="submit()">

  <div class="modal fade show d-block">
    <div class="modal-dialog modal-dialog-centered modal-xl">
      <div class="modal-content rounded-4 shadow-lg border-0">

        <!-- HEADER -->
        <div class="modal-header bg-primary text-white rounded-top-4">
          <h5 class="modal-title">
            {{ mode === 'add' ? 'Add Category' : 'Edit Category' }}
          </h5>
          <button class="btn-close btn-close-white" (click)="closeModal()"></button>
        </div>

        <!-- BODY -->
        <div class="modal-body p-4">
          <div class="row g-4">

            <!-- NAME -->
            <div class="col-md-4">
              <label class="form-label fw-semibold">Category Name *</label>
              <input class="form-control"
                     formControlName="name"
                     (input)="updateSlug($event)">
              <small class="text-danger"
                *ngIf="categoryForm.get('name')?.touched && categoryForm.get('name')?.invalid">
                Minimum 3 characters required
              </small>
            </div>

            <!-- SLUG -->
            <div class="col-md-4">
              <label class="form-label fw-semibold">Slug *</label>
              <input class="form-control bg-light" formControlName="slug" readonly>
            </div>

            <!-- TYPE -->
            <div class="col-md-4">
              <label class="form-label fw-semibold">Category Type *</label>
              <select class="form-select" formControlName="categoryType">
                <option value="">Select</option>
                <option *ngFor="let t of categoryTypes" [value]="t.id">
                  {{ t.name }}
                </option>
              </select>
              <small class="text-danger"
                *ngIf="categoryForm.get('categoryType')?.touched
                       && categoryForm.get('categoryType')?.invalid">
                Category type is required
              </small>
            </div>

            <!-- IMAGE -->
            <div class="col-md-8">
              <label class="form-label fw-semibold">Image URL</label>
              <input class="form-control" formControlName="imageUrl">
            </div>

            <div class="col-md-4 text-center">
              <img
                [src]="categoryForm.get('imageUrl')?.value || 'https://via.placeholder.com/120'"
                class="img-thumbnail"
                style="width:120px;height:120px;object-fit:cover">
            </div>

            <!-- ORDER -->
            <div class="col-md-3">
              <label class="form-label fw-semibold">Order *</label>
              <input type="number" class="form-control" formControlName="order">
            </div>

            <!-- PRIORITY -->
            <div class="col-md-3">
              <label class="form-label fw-semibold">Priority *</label>
              <input type="number" class="form-control" formControlName="priority">
            </div>

            <!-- DISPLAY SECTIONS -->
            <div class="col-md-6">
              <label class="form-label fw-semibold">Display Sections *</label>
              <div class="d-flex gap-4">
                <div class="form-check"
                     *ngFor="let s of displaySectionOptions">
                  <input #chk
                         class="form-check-input"
                         type="checkbox"
                         [checked]="categoryForm.get('displaySections')?.value?.includes(s.id)"
                         (change)="toggleArrayValue('displaySections', s.id, chk.checked)">
                  <label class="form-check-label">{{ s.name }}</label>
                </div>
              </div>

              <small class="text-danger"
                *ngIf="categoryForm.get('displaySections')?.touched
                       && categoryForm.get('displaySections')?.invalid">
                Select at least one section
              </small>
            </div>

            <!-- BADGES -->
            <div class="col-md-12">
              <label class="form-label fw-semibold">Badges</label>
              <div class="d-flex gap-3 flex-wrap">
                <div *ngFor="let b of badgeOptions">
                  <input #badgeChk
                         type="checkbox"
                         class="btn-check"
                         id="{{ b.id }}"
                         [checked]="categoryForm.get('badges')?.value?.includes(b.id)"
                         (change)="toggleArrayValue('badges', b.id, badgeChk.checked)">
                  <label class="btn btn-outline-primary rounded-pill px-3"
                         for="{{ b.id }}">
                    {{ b.name }}
                  </label>
                </div>
              </div>
            </div>

            <!-- STATUS -->
            <div class="col-md-12 d-flex gap-5 mt-2">
              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" formControlName="isActive">
                <label class="form-check-label">Active</label>
              </div>

              <div class="form-check form-switch">
                <input class="form-check-input" type="checkbox" formControlName="isOnlineVisible">
                <label class="form-check-label">Visible Online</label>
              </div>
            </div>

          </div>
        </div>

        <!-- FOOTER -->
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-light" (click)="closeModal()">Cancel</button>

          <button type="submit"
                  class="btn btn-primary"
                  [disabled]="categoryForm.invalid || loading">

            <span *ngIf="!loading">
              {{ mode === 'add' ? 'Save Category' : 'Update Category' }}
            </span>

            <span *ngIf="loading">
              <span class="spinner-border spinner-border-sm me-2"></span>
              Saving...
            </span>

          </button>
        </div>

      </div>
    </div>
  </div>

  <div class="modal-backdrop fade show"></div>
</form>