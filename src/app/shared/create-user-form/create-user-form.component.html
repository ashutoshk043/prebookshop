<!-- Sidebar -->
<app-sidebar #sidebar></app-sidebar>

<!-- Main Content -->
<div class="main-content" [class.sidebar-collapsed]="sidebar.isCollapsed">
  <main class="content-area container-fluid py-4">
    <div class="container-fluid">
      <div class="card shadow border-0 rounded-4 p-3 p-md-4 mx-auto position-relative" style="max-width: 1200px;">

        <!-- Close Button -->
        <button type="button" class="btn-close position-absolute top-0 end-0 m-2 m-md-3" aria-label="Close"
          (click)="closeFormClicked()"></button>

        <!-- Heading -->
        <h3 class="text-center mb-3 mb-md-4 fw-bold text-primary">User Registration</h3>

        <!-- Scrollable Form Container -->
        <div class="form-scroll-container">
          <form [formGroup]="registerForm" (ngSubmit)="onSubmit()" class="w-100">
            <div class="row g-2 g-md-3">

              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Full Name <span class="text-danger">*</span></label>
                <input type="text" formControlName="name" class="form-control" placeholder="Enter full name" />
                <div *ngIf="registerForm.get('name')?.touched && registerForm.get('name')?.invalid"
                  class="text-danger small mt-1">
                  <div *ngIf="registerForm.get('name')?.errors?.['required']">Full name is required.</div>
                  <div *ngIf="registerForm.get('name')?.errors?.['minlength']">Minimum 3 characters required.</div>
                  <div *ngIf="registerForm.get('name')?.errors?.['pattern']">Only alphabets allowed.</div>
                </div>
              </div>

              <!-- Email -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Email <span class="text-danger">*</span></label>
                <input type="email" formControlName="email" class="form-control" placeholder="Enter email" />
                <div *ngIf="registerForm.get('email')?.touched && registerForm.get('email')?.invalid"
                  class="text-danger small mt-1">
                  <div *ngIf="registerForm.get('email')?.errors?.['required']">Email is required.</div>
                  <div *ngIf="registerForm.get('email')?.errors?.['email']">Invalid email.</div>
                </div>
              </div>

              <!-- Phone -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Mobile <span class="text-danger">*</span></label>
                <input type="tel" formControlName="phone" class="form-control" placeholder="Enter mobile number" />
                <div *ngIf="registerForm.get('phone')?.touched && registerForm.get('phone')?.invalid"
                  class="text-danger small mt-1">
                  <div *ngIf="registerForm.get('phone')?.errors?.['required']">Mobile is required.</div>
                  <div *ngIf="registerForm.get('phone')?.errors?.['pattern']">Enter valid 10-digit number.</div>
                </div>
              </div>

              <!-- Password -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Password <span class="text-danger">*</span></label>
                <input type="password" formControlName="password" class="form-control" placeholder="Enter password" />
                <div *ngIf="registerForm.get('password')?.touched && registerForm.get('password')?.invalid"
                  class="text-danger small mt-1">
                  <div *ngIf="registerForm.get('password')?.errors?.['required']">Password is required.</div>
                  <div *ngIf="registerForm.get('password')?.errors?.['minlength']">Min 6 characters.</div>
                </div>
              </div>

              <!-- Confirm Password -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Confirm Password <span class="text-danger">*</span></label>
                <input type="password" formControlName="confirmPassword" class="form-control"
                  placeholder="Re-enter password" />
                <div *ngIf="registerForm.get('confirmPassword')?.touched && registerForm.errors?.['passwordMismatch']"
                  class="text-danger small mt-1">
                  Passwords do not match.
                </div>
              </div>

              <!-- State Dropdown -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">State <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="state">
                  <option value="">Select State</option>
                  <option *ngFor="let s of states" [value]="s">{{ s }}</option>
                </select>
                <div *ngIf="registerForm.get('state')?.touched && registerForm.get('state')?.invalid"
                  class="text-danger small mt-1">
                  State is required.
                </div>
              </div>

              <!-- District Dropdown -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">District <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="district">
                  <option value="">Select District</option>
                  <option *ngFor="let d of districts" [value]="d">{{ d }}</option>
                </select>
                <div *ngIf="registerForm.get('district')?.touched && registerForm.get('district')?.invalid"
                  class="text-danger small mt-1">
                  District is required.
                </div>
              </div>

              <!-- Block Dropdown -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Block <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="block">
                  <option value="">Select Block</option>
                  <option *ngFor="let b of blocks" [value]="b">{{ b }}</option>
                </select>
                <div *ngIf="registerForm.get('block')?.touched && registerForm.get('block')?.invalid"
                  class="text-danger small mt-1">
                  Block is required.
                </div>
              </div>

              <!-- Village Dropdown -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Village</label>
                <select class="form-select" formControlName="village">
                  <option value="">Select Village</option>
                  <option *ngFor="let v of villages" [value]="v">{{ v }}</option>
                </select>
              </div>

              <!-- Status -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Status <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="status">
                  <option value="">Select status</option>
                  <option value="active">Active</option>
                  <option value="inactive">Inactive</option>
                  <option value="suspended">Suspended</option>
                </select>
              </div>

              <!-- Profile Image -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Profile Image URL</label>
                <input type="text" class="form-control" formControlName="profile"
                  placeholder="Enter profile image URL" />
              </div>

              <!-- Role -->
              <div class="col-12 col-sm-6 col-lg-4">
                <label class="form-label fw-semibold">Role <span class="text-danger">*</span></label>
                <select class="form-select" formControlName="roleId" (change)="onRoleChange($event)">
                  <option value="">Select role</option>
                  <option *ngFor="let role of roles" [value]="role.id">{{ role.name }}</option>
                </select>
              </div>
            </div>

            <!-- ðŸ´ Restaurant Section (Only for r6) -->
            <div class="mt-3 mt-md-4" formGroupName="restaurant" *ngIf="registerForm.get('roleId')?.value === 'r6'">
              <div class="card border-0 shadow-sm rounded-4 p-3 p-md-4 bg-light">
                <h5 class="fw-bold mb-3 text-primary">
                  <i class="bi bi-shop"></i> Restaurant Details
                </h5>

                <div class="row g-2 g-md-3">
                  <!-- Restaurant Name -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Restaurant Name <span class="text-danger">*</span></label>
                    <input class="form-control" placeholder="Enter restaurant name" formControlName="restaurantName" />
                    <div
                      *ngIf="registerForm.get('restaurant.restaurantName')?.touched && registerForm.get('restaurant.restaurantName')?.invalid"
                      class="text-danger small mt-1">
                      Restaurant name is required.
                    </div>
                  </div>

                  <!-- Type -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Type <span class="text-danger">*</span></label>
                    <select class="form-select" formControlName="restaurantType">
                      <option value="">Select Type</option>
                      <option value="cloud_kitchen">Cloud Kitchen</option>
                      <option value="cafe">Cafe</option>
                      <option value="restaurant">Restaurant</option>
                      <option value="hygienic_cart">Hygienic Cart</option>
                    </select>
                    <div
                      *ngIf="registerForm.get('restaurant.restaurantType')?.touched && registerForm.get('restaurant.restaurantType')?.invalid"
                      class="text-danger small mt-1">
                      Restaurant type is required.
                    </div>
                  </div>

                  <!-- Pincode -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Restaurant Address</label>
                    <input class="form-control" placeholder="Enter Restaurant Address"
                      formControlName="restaurantAddress" />
                    <div
                      *ngIf="registerForm.get('restaurant.restaurantAddress')?.touched && registerForm.get('restaurant.restaurantAddress')?.errors?.['pattern']"
                      class="text-danger small mt-1">
                      Invalid restaurantAddress.
                    </div>
                  </div>

                  <!-- Pincode -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Pincode</label>
                    <input class="form-control" placeholder="Enter pincode" formControlName="pincode" />
                    <div
                      *ngIf="registerForm.get('restaurant.pincode')?.touched && registerForm.get('restaurant.pincode')?.errors?.['pattern']"
                      class="text-danger small mt-1">
                      Enter a valid 6-digit pincode.
                    </div>
                  </div>

                  <!-- Latitude -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Latitude</label>
                    <input class="form-control" placeholder="Enter latitude" formControlName="latitude" />
                    <div
                      *ngIf="registerForm.get('restaurant.latitude')?.touched && registerForm.get('restaurant.latitude')?.errors?.['pattern']"
                      class="text-danger small mt-1">
                      Enter a valid latitude.
                    </div>
                  </div>

                  <!-- Longitude -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Longitude</label>
                    <input class="form-control" placeholder="Enter longitude" formControlName="longitude" />
                    <div
                      *ngIf="registerForm.get('restaurant.longitude')?.touched && registerForm.get('restaurant.longitude')?.errors?.['pattern']"
                      class="text-danger small mt-1">
                      Enter a valid longitude.
                    </div>
                  </div>

                  <!-- Logo Url -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Logo URL</label>
                    <input type="text" class="form-control" formControlName="logoUrl"
                      placeholder="Enter logoUrl image URL" />
                  </div>

                  <!-- Cover Image -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Cover URL</label>
                    <input type="text" class="form-control" formControlName="coverImageUrl"
                      placeholder="Enter coverImageUrl image URL" />
                  </div>

                  <!-- Address, FSSAI, GST, etc. -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">FSSAI Number</label>
                    <input class="form-control" placeholder="Enter FSSAI number" formControlName="fssaiNumber" />
                  </div>

                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">GST Number</label>
                    <input class="form-control" placeholder="Enter GST number" formControlName="gstNumber" />
                  </div>

                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">PAN Number</label>
                    <input class="form-control" placeholder="Enter PAN number" formControlName="panNumber" />
                  </div>

                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Registration Date</label>
                    <input type="date" class="form-control" formControlName="registrationDate" />
                  </div>

                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Opening Time</label>
                    <input type="time" class="form-control" formControlName="openingTime" />
                  </div>

                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Closing Time</label>
                    <input type="time" class="form-control" formControlName="closingTime" />
                  </div>

                  <!-- is Verified -->
                  <div class="col-12 col-sm-6 col-lg-4">
                    <label class="form-label fw-semibold">Verified <span class="text-danger">*</span></label>
                    <select class="form-select" formControlName="isVerified">
                      <option value="">Select isVerified</option>
                      <option value="true">YES</option>
                      <option value="false">NO</option>
                    </select>
                  </div>

                  <div class="col-12">
                    <label class="form-label fw-semibold">Description</label>
                    <textarea class="form-control" rows="3" placeholder="Write something..."
                      formControlName="description"></textarea>
                  </div>
                </div>
              </div>
            </div>
            <!-- Submit Button -->
            <div class="text-center mt-3 mt-md-4">
              <button type="submit" class="btn btn-primary btn-lg px-4 px-md-5" [disabled]="registerForm.invalid">
                <i class="bi bi-person-plus-fill me-2"></i> Register User
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </main>
</div>