<form [formGroup]="productForm" (ngSubmit)="submit()">

  <div class="modal fade show d-block" id="productModal">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">

        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title">
            {{ formMode === 'add' ? 'Add Product' : 'Edit Product' }}
          </h5>
          <button class="btn-close btn-close-white" (click)="closeModal()"></button>
        </div>

        <div class="modal-body">

          <!-- Name -->
          <label class="form-label">Product Name *</label>
          <input class="form-control" formControlName="name" (input)="updateSlug($event)">

          <!-- Slug -->
          <label class="form-label mt-2">Slug</label>
          <input class="form-control bg-light" formControlName="slug" readonly>

          <!-- Category -->
          <label class="form-label mt-2">Category *</label>
          <select class="form-select" formControlName="categoryId">
            <option value="">Select</option>
            <option *ngFor="let c of categories" [value]="c._id">
              {{ c.name }}
            </option>
          </select>

          <!-- Description -->
          <label class="form-label mt-2">Description</label>
          <textarea class="form-control" rows="3" formControlName="description"></textarea>

          <!-- Image -->
          <label class="form-label mt-2">Image URL</label>
          <input class="form-control" formControlName="imageUrl" (input)="previewImage = productForm.value.imageUrl">

          <img *ngIf="previewImage" [src]="previewImage" class="img-thumbnail mt-2" style="max-width:120px">

          <!-- Tags -->
          <label class="form-label mt-3">Tags</label>

          <div class="d-flex gap-2 flex-wrap">
            <div *ngFor="let t of tagOptions">
              <input #chk type="checkbox" [checked]="productForm.value.tags?.includes(t.id)"
                (change)="toggleTag(t.id, chk.checked)" />
              {{ t.name }}
            </div>
          </div>

          <!-- Switches -->
          <div class="d-flex gap-4 mt-3">
            <label><input type="checkbox" formControlName="isVeg"> Veg</label>
            <label><input type="checkbox" formControlName="isActive"> Active</label>
            <label><input type="checkbox" formControlName="isOnlineVisible"> Online</label>
          </div>

        </div>

        <div class="modal-footer">
          <button class="btn btn-light" type="button" (click)="closeModal()">Cancel</button>
          <button class="btn btn-primary" type="submit">
            {{ formMode === 'add' ? 'Save' : 'Update' }}
          </button>
        </div>

      </div>
    </div>
  </div>

  <div class="modal-backdrop fade show"></div>
</form>