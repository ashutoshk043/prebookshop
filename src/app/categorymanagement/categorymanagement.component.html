<div class="d-flex flex-column flex-md-row">
  <app-sidebar #sidebar></app-sidebar>

  <div
    class="main-content flex-grow-1"
    [class.sidebar-collapsed]="sidebar?.isCollapsed"
  >
    <app-header></app-header>

    <div class="container-fluid mt-4">

      <!-- Add Category Button -->
      <div class="d-flex justify-content-end mb-4">
        <button class="btn btn-primary" (click)="openCategoryForm('add')">
          <i class="bi bi-plus-lg me-2"></i> Add Category
        </button>
      </div>

      <!-- Card -->
      <div class="card shadow-sm border-0">
        <div class="card-body p-0 position-relative">

          <!-- ðŸ”’ Overlay Loader (NO DOM DESTROY) -->
          <div class="loading-overlay" *ngIf="isLoading">
            <div class="spinner-border text-primary"></div>
          </div>

          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">

              <thead class="table-light">
                <tr>
                  <th>#</th>
                  <th>Image</th>
                  <th>Name</th>
                  <th>Slug</th>

                  <!-- SORTABLE ORDER -->
                  <th style="cursor:pointer" (click)="sortByOrder()">
                    Order
                    <span class="sort-icon ms-1">
                      <i
                        *ngIf="sortField !== 'order'"
                        class="bi bi-arrow-down-up text-muted"
                      ></i>
                      <i
                        *ngIf="sortField === 'order' && sortDirection === 'asc'"
                        class="bi bi-arrow-up"
                      ></i>
                      <i
                        *ngIf="sortField === 'order' && sortDirection === 'desc'"
                        class="bi bi-arrow-down"
                      ></i>
                    </span>
                  </th>

                  <th>Status</th>
                  <th>Online Visible</th>
                  <th class="text-end">Action</th>
                </tr>
              </thead>

              <tbody>
                <tr
                  *ngFor="let category of categories; let i = index; trackBy: trackById"
                >
                  <td>{{ (currentPage - 1) * pageSize + i + 1 }}</td>

                  <td>
                    <img
                      [src]="category.imageUrl"
                      class="rounded"
                      width="45"
                      height="45"
                      alt="{{ category.name }}"
                    />
                  </td>

                  <td class="fw-medium">{{ category.name }}</td>
                  <td>{{ category.slug }}</td>
                  <td>{{ category.order }}</td>

                  <td>
                    <span
                      class="badge"
                      [ngClass]="category.isActive ? 'bg-success' : 'bg-danger'"
                    >
                      {{ category.isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>

                  <td>
                    <span
                      class="badge"
                      [ngClass]="category.isOnlineVisible ? 'bg-success' : 'bg-secondary'"
                    >
                      {{ category.isOnlineVisible ? 'Yes' : 'No' }}
                    </span>
                  </td>

                  <td class="text-end">
                    <button
                      class="btn btn-sm btn-warning me-2"
                      (click)="openCategoryForm('edit', category)"
                    >
                      Edit
                    </button>
                    <button
                      class="btn btn-sm btn-danger"
                      (click)="deleteCategory(category._id)"
                    >
                      Delete
                    </button>
                  </td>
                </tr>

                <!-- Empty State -->
                <tr *ngIf="!isLoading && categories?.length === 0">
                  <td colspan="8" class="text-center py-4 text-muted">
                    No categories found
                  </td>
                </tr>
              </tbody>

            </table>
          </div>

        </div>
      </div>

      <!-- PAGINATION -->
      <div
        class="d-flex justify-content-between align-items-center mt-3 px-2"
        *ngIf="!isLoading && totalPages > 1"
      >
        <span class="text-muted small">
          Showing
          {{ (currentPage - 1) * pageSize + 1 }}â€“
          {{ currentPage * pageSize > totalRecords ? totalRecords : currentPage * pageSize }}
          of {{ totalRecords }} categories
        </span>

        <ul class="pagination mb-0">

          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="changePage(1)">Â«</button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === 1">
            <button class="page-link" (click)="changePage(currentPage - 1)">â€¹</button>
          </li>

          <li
            class="page-item"
            *ngFor="let page of visiblePages"
            [class.active]="currentPage === page"
          >
            <button class="page-link" (click)="changePage(page)">
              {{ page }}
            </button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="changePage(currentPage + 1)">â€º</button>
          </li>

          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <button class="page-link" (click)="changePage(totalPages)">Â»</button>
          </li>

        </ul>
      </div>

    </div>
  </div>
</div>

<!-- Category Form -->
<app-category-form
  *ngIf="showForm"
  (close)="closeCategoryForm()"
></app-category-form>