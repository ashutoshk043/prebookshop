<app-sidebar #sidebar></app-sidebar>

<div class="main-content" [class.sidebar-collapsed]="sidebar.isCollapsed">
  <app-header></app-header>

  <main class="container-fluid py-4">

    <!-- Page Header -->
    <div class="d-flex flex-column flex-md-row justify-content-between align-items-start align-items-md-center mb-4">
      <h2 class="h4 fw-semibold mb-3 mb-md-0">User Management</h2>
      <button class="btn btn-primary d-flex align-items-center gap-2" (click)="openRegisterForm(true)">
        <i class="bi bi-plus-lg"></i>
        Add New User
      </button>
    </div>

    <!-- Stats -->
    <div class="row g-3 mb-4">
      <div class="col-sm-6 col-lg-3">
        <div class="card shadow-sm border-0">
          <div class="card-body d-flex align-items-center gap-3">
            <div class="bg-primary bg-opacity-10 text-primary rounded p-3">
              <i class="bi bi-people fs-4"></i>
            </div>
            <div>
              <p class="text-muted mb-1 small">Total Users</p>
              <h4 class="mb-1">{{ filteredUsers.length }}</h4>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Filters -->
    <div class="card shadow-sm border-0 mb-4">
      <div class="card-body">
        <div class="row g-3 align-items-center">

          <!-- Search -->
          <div class="col-md-4">
            <div class="input-group">
              <span class="input-group-text bg-white border-end-0">
                <i class="bi bi-search text-muted"></i>
              </span>
              <input 
                type="text" 
                class="form-control border-start-0" 
                placeholder="Search users..."
                [(ngModel)]="searchText"
                (input)="filterUsers()"
              />
            </div>
          </div>

          <!-- Role Filter -->
          <div class="col-md-3">
            <select class="form-select" [(ngModel)]="selectedRole" (change)="filterUsers()">
              <option value="">All Roles</option>
              <option *ngFor="let role of roles" [value]="role.id">
                {{ role.name }}
              </option>
            </select>
          </div>

          <!-- Status Filter -->
          <div class="col-md-3">
            <select class="form-select" [(ngModel)]="selectedStatus" (change)="filterUsers()">
              <option value="">All Status</option>
              <option>Active</option>
              <option>Inactive</option>
              <option>Pending</option>
            </select>
          </div>

        </div>
      </div>
    </div>

    <!-- Users Table -->
    <div class="card shadow-sm border-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light text-uppercase small text-muted">
            <tr>
              <th><input type="checkbox" class="form-check-input" /></th>
              <th>User</th>
              <th>Email</th>
              <th>Role</th>
              <th>Status</th>
              <th>Actions</th>
            </tr>
          </thead>

          <tbody>
            <tr *ngFor="let data of paginatedUsers">
              <td><input type="checkbox" class="form-check-input" /></td>

              <td>
                <div class="d-flex align-items-center gap-2">
                  <div class="rounded-circle bg-primary text-white d-flex align-items-center justify-content-center"
                       style="width:40px; height:40px;">
                    {{ data.name[0] }}
                  </div>

                  <div>
                    <div class="fw-medium">{{ data.name }}</div>
                    <small class="text-muted">#{{ data._id }}</small>
                  </div>
                </div>
              </td>

              <td>{{ data.email }}</td>

              <td>
                <span class="badge bg-warning text-dark">
                  {{ getRoleName(data.roleId) }}
                </span>
              </td>

              <td>
                <span class="badge bg-success">{{ data.status }}</span>
              </td>

              <td>
                <div class="btn-group btn-group-sm">
                  <button class="btn btn-outline-secondary" (click)="editRegisterForm(data)"><i class="bi bi-pencil" ></i></button>
                  <button class="btn btn-outline-secondary" (click)="viewUser(data._id)"><i class="bi bi-eye" ></i></button>
                  <button class="btn btn-outline-danger" (click)="deletedUser(data._id)"><i class="bi bi-trash" ></i></button>
                </div>
              </td>
            </tr>
          </tbody>

        </table>
      </div>

      <!-- Pagination -->
      <div class="card-footer d-flex flex-column flex-md-row justify-content-between align-items-center">
        
        <div class="text-muted small mb-2 mb-md-0">
          Showing 
          {{ (currentPage - 1) * pageSize + 1 }} 
          to 
          {{ Math.min(currentPage * pageSize, filteredUsers.length) }} 
          of 
          {{ filteredUsers.length }} users
        </div>

        <nav>
          <ul class="pagination mb-0">

            <li class="page-item" [class.disabled]="currentPage === 1">
              <button class="page-link" (click)="prevPage()">Previous</button>
            </li>

            <li class="page-item" 
                *ngFor="let page of pageNumbers"
                [class.active]="currentPage === page">
              <button class="page-link" (click)="goToPage(page)">{{ page }}</button>
            </li>

            <li class="page-item" [class.disabled]="currentPage === totalPages">
              <button class="page-link" (click)="nextPage()">Next</button>
            </li>
          </ul>
        </nav>
      </div>
    </div>

  </main>
</div>

<div *ngIf="showForm" class="center-register-form-container">
  <app-create-user-form
    (closeForm)="closeFormClicked($event)"
     [loggedInRestIid]="loggedInRestIid"
    [editForm]="editFormData"
    >
  </app-create-user-form>
</div>

